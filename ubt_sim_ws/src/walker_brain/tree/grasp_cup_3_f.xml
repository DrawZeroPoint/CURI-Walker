<?xml version="1.0"?>
<root main_tree_to_execute="BehaviorTree">
    <!-- ////////// -->
    <BehaviorTree ID="BehaviorTree">
        <Sequence>
            <Action ID="SenseObjectPoses" goal_id="cylinder" obj_poses="{detected_obj_poses}" service_name="/head/extract_object_on_top"/>
            <Action ID="EstimateTargetPose" obj_poses="{detected_obj_poses}" service_name="estimate_target_pose" tgt_grasp_pose="{target_grasp_pose}" tgt_nav_pose="{target_nav_pose}" tgt_pre_grasp_pose="{target_pre_grasp_pose}"/>
            <Action ID="ExecuteNavigation" service_name="/move_base/move_to_rel_pos" tgt_nav_pose="{target_nav_pose}"/>
            <Action ID="ExecutePreGrasp" execute_pose="{target_pre_grasp_pose}" server_name="/walker/move_helper_left_arm/move_to_ee_pose"/>
            <Action ID="ExecuteGrasp" server_name="/walker/move_helper_left_arm/move_to_ee_pose" tgt_grasp_pose="{target_grasp_pose}"/>
            <Action ID="ExecuteCloseHand" server_name="/walker/hand_helper_left/grasp"/>
            <Action ID="ExecutePostGrasp" execute_pose="{target_pre_grasp_pose}" server_name="/walker/move_helper_left_arm/move_to_ee_pose"/>
        </Sequence>
    </BehaviorTree>
    <!-- ////////// -->
    <TreeNodesModel>
        <Action ID="EstimateTargetPose">
            <input_port default="{detected_obj_poses}" name="obj_poses">Detected cup poses</input_port>
            <input_port default="estimate_target_pose" name="service_name"/>
            <output_port default="{target_grasp_pose}" name="tgt_grasp_pose">This is the tcp pose for grasping the cup after the robot has reached the position </output_port>
            <output_port default="{target_nav_pose}" name="tgt_nav_pose">This is the destination pose that the robot needs to go</output_port>
            <output_port default="{target_pre_grasp_pose}" name="tgt_pre_grasp_pose"/>
        </Action>
        <Action ID="ExecuteCloseHand">
            <input_port default="/walker/hand_helper_left/grasp" name="server_name"/>
        </Action>
        <Action ID="ExecuteGrasp">
            <input_port default="/walker/move_helper_left_arm/move_to_ee_pose" name="server_name"/>
            <input_port default="{target_grasp_pose}" name="tgt_grasp_pose"/>
        </Action>
        <Action ID="ExecuteNavigation">
            <input_port default="/move_base/move_to_rel_pos" name="service_name"/>
            <input_port default="{target_nav_pose}" name="tgt_nav_pose"/>
        </Action>
        <Action ID="ExecutePostGrasp">
            <input_port default="{target_pre_grasp_pose}" name="execute_pose"/>
            <input_port default="/walker/move_helper_left_arm/move_to_ee_pose" name="server_name"/>
        </Action>
        <Action ID="ExecutePreGrasp">
            <input_port default="{target_pre_grasp_pose}" name="execute_pose"/>
            <input_port default="/walker/move_helper_left_arm/move_to_ee_pose" name="server_name"/>
        </Action>
        <Action ID="ExecuteToGraspPose">
            <input_port default="/walker/move_helper_left_arm/move_to_ee_pose" name="server_name"/>
            <input_port default="{target_grasp_pose}" name="tgt_grasp_pose"/>
        </Action>
        <Action ID="SenseObjectPoses">
            <input_port default="cylinder" name="goal_id"/>
            <output_port default="{detected_obj_poses}" name="obj_poses"/>
            <input_port default="/head/extract_object_on_top" name="service_name"/>
        </Action>
    </TreeNodesModel>
    <!-- ////////// -->
</root>

